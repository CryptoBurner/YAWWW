---
title: "YAWWW NFT Listings on Magic Eden"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("YAWWW Undervalued.R")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
g.dat <- dat.all %>% filter(diff > 0) %>% 
  #filter(Price < 20) %>% 
  dplyr::arrange(-diff) %>% mutate(best = ifelse(row_number() <=10 | nft == "SS","Top 10",""))

g.dat %>% 
  ggplot(aes(Price, YAW.num, colour = best)) +
  geom_point() +
  theme_bw() +
  xlab(paste0("NFT Price (SOL)")) +
  ylab(paste0("Total $YAW Yield Remaining")) + 
  geom_abline(intercept = 0, slope = y.s, color="red",linetype="dashed", size=1.5)  + 
  geom_label_repel(data=subset(g.dat,best == "Top 10"),
                   aes(label=Name),size = 3, color = "blue") +
  geom_label(aes(x = 11.5,y = 10*y.s,
                label = paste0("YAW price in SOL",
                "\nSOL @ $",round(sol.price,2),
                "\nYAW @ $",round(YAW.price,4))  
                ), colour = "red") +
  theme(legend.position="none") +
  ggtitle("Undervalued YAWWWW NFTs","Top Ten in Blue")


dat.all %>% filter(!is.na(Price)) %>%
  mutate(price2 = as.factor(round(Price/.5)*.5)) %>% 
  group_by(price2) %>% 
  summarise(n = n(), sol.total = sum(Price)) %>% 
  mutate(total = cumsum(n), sol.total = cumsum(sol.total)) %>% 
  ggplot() + 
  geom_bar(aes(x = price2, y = total),stat="identity", fill = "blue") +
  geom_line(aes(x = price2, y = sol.total/10),size = 1, color="red", group = 1) + 
  theme_classic() +
  ylab("Total Sales Needed") +
  xlab("Floor Price") +
  geom_text(aes(x = price2, y = total,label=total), vjust=-0.5, color="black", size=3.5) +
  ggtitle("Number of YAWWW NFT Sells on ME Needed to Move Up Floor Price") + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  scale_y_continuous(sec.axis = sec_axis(~.*10, name = "Total SOL Sale Volume Needed"))


dat.all %>% filter(!is.na(Price)) %>%
  mutate(price2 = as.factor(round(Price/.5)*.5)) %>% 
  group_by(price2) %>% 
  summarise(n = n(), sol.total = sum(Price)) %>% 
  mutate(total = cumsum(n), sol.total = cumsum(sol.total)) %>% 
  ggplot() + 
  geom_bar(aes(x = price2, y = n),stat="identity", fill = "blue") +
  #geom_line(aes(x = price2, y = sol.total/10),size = 1, color="red", group = 1) + 
  theme_classic() +
  ylab("# Listed") +
  xlab("Price") +
  geom_text(aes(x = price2, y = n,label=n), vjust=-0.5, color="black", size=3.5) +
  ggtitle("Listing Prices") + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))
+
  scale_y_continuous(sec.axis = sec_axis(~.*10, name = "Total SOL Sale Volume Needed"))
```
